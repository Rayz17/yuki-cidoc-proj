# 瑶山文物数据抽取项目 - 主计划文档


## 1. 项目目标

创建一个用于从考古发掘报告中抽取文物信息的自动化系统，它具备一个命令行界面（CLI）和一个图形用户界面（GUI），支持可配置的LLM服务。

### 核心子目标

1.  **支持多模板与报告**：灵活支持多种文物类型的独立数据结构模板和多个报告文件。
2.  **LLM驱动的核心引擎**：将LLM能力作为**常态化手段**，用于实体识别、关系抽取和文本分类，以处理不同报告的不一致性。
3.  **配置化与可扩展的存储**：通过配置文件管理外部服务（如LLM API），结果存入统一的轻量级数据库（SQLite）。
4.  **用户友好界面 **(NEW)：提供GUI以简化操作，包括报告/模板选择、数据库浏览、数据导出和LLM服务配置。


## 2. 需求细化与分析

| 模块 | 子任务 | 技术实现方式 | 状态 |
| :--- | :--- | :--- | :--- |
| **1. 报告与数据结构的管理** | 存储和索引报告及数据结构模板。 | 使用文件系统。将Excel模板解析为Python `dataclass`。 | [x] 完成 |
| **2. 内容处理引擎** | 分割文本，执行LLM驱动的抽取。 | 集成LLM API (如Claude) 作为主流程。 | [x] 完成 |
| **3. 智能实体与关系识别** | 将文本描述映射到 `文化特征单元` 和 `单品编码`。 | **常态化**使用LLM API进行NLP任务。 | [x] 完成 |
| **4. 数据持久化与存储** | 存储结果。 | 使用 **SQLite** 数据库。 | [x] 完成 |
| **5. 配置管理 **(NEW) | 管理外部服务（LLM）和系统设置。 | 使用 `config.json` 或 `.env` 文件。 | [x] 完成 |
| **6. 用户界面 **(NEW) | 为用户提供可视化操作界面。 | 使用 `tkinter`/`PyQt` (桌面) 或 `Streamlit`/`Gradio` (Web)。 | [x] 完成 |


## 3. 总体架构设计

```
                          +---------------------+
                          |      用户 (CLI/GUI)   |
                          +----------+----------+
                                     |
                                     v
                 +-------------------------------------+
                 |             主应用引擎               |
                 |  +--------------+   +--------------+ |
                 |  | 配置管理模块 | ← | LLM API服务 | |
                 |  +--------------+   +--------------+ |
                 |               |                 |
                 |  +--------------+   +--------------+ |
                 |  | 报告管理模块 | → | 模板管理模块 | |
                 |  +--------------+   +--------------+ |
                 |               |                 |
                 |           ↓ (文本内容)           |
                 |  +---------------------------+     |
                 |  |     核心抽取引擎          | ←--+ (LLM)
                 |  | - 按墓葬分割文本        |     |
                 |  | - 调用LLM进行NLP任务    |     |
                 |  +---------------------------+     |
                 |               |                 |
                 |           ↓ (结构化数据)         |
                 |  +------------------------------+ |
                 |  |        数据库模块            | |
                 |  | - 查询、浏览、导出功能     | |
                 |  +------------------------------+ |
                 +-------------------------------------+
```


## 4. 更新后的开发计划 (两版本策略)

| 任务ID | 任务描述 | 优先级 | 当前状态 | 里程牌 |
| :--- | :--- | :---: | :--- | :---: |
| **Stage 0: 基础重构 **(NEW) | | | | |
| S0.1 | 创建配置文件: `config.json`。 | Low | [x] 完成 | `config.json` 已创建，包含LLM和路径配置。 |
| **Stage 1: LLM 集成 **(新重点)| | | | |
| T3.1 | 集成LLM API（如Claude），作为 `automated_extractor` 的主干。 | Highest | [x] 完成 | `src/automated_extractor.py` 已实现真实的LLM API调用，支持HTTP请求和JSON解析。 |
| T3.2 | 设计鲁棒的提示词，可处理不同行文风格。 | Highest | [x] 完成 | `prompts/extract_artifacts_prompt.txt` 已创建，可用于任何良渚文化报告。 |
| T3.3 | 实现Excel模板的真实加载功能。 | High | [x] 完成 | `src/report_processor.py` 已使用pandas实现Excel文件加载。 |
| T3.4 | 修复main.py中的键名不一致问题。 | Medium | [x] 完成 | 已修复模板关键词提取逻辑。 |
| T3.5 | 创建requirements.txt依赖文件。 | Medium | [x] 完成 | 已创建包含所有必需依赖的requirements.txt文件。 |
| **Stage 2: GUI 开发 **(NEW) | | | | |
| G1 | 迭新设计GUI主窗口。 | High | [x] 完成 | 为报告/模板选择和LLM配置设计了可用的操作界面。 |
| G2 | 实现报告/模板选择和数据库浏览功能。 | High | [x] 完成 | 功能已集成，用户可操作选择文件和浏览数据。 |
| G3 | 实现数据导出和LLM配置功能。 | Medium | [x] 完成 | 功能已实现，配置可保存，数据可导出。 |
| **Stage 3: 最终化** | | | | |
| T4.1 | 优化 `main.py` CLI脚本，读取配置。 | Low | [x] 完成 | CLI脚本已与配置系统集成。 |
| T4.3 | 创建一个 `README.md` 文件，并编制操作手册。 | Low | [x] 完成 | 已撰写详细的使用步骤和操作手册。 |

---

*最后更新： 2024年12月（最新）*