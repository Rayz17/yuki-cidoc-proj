# V3.2 架构升级指南

## 1. 版本说明

V3.2 版本引入了 **"元数据驱动 (Meta-Model Driven)"** 和 **"语义双层存储"** 架构。

*   **主要变更**：
    *   新增 `sys_template_mappings` 表：存储 Excel 模版定义。
    *   新增 `fact_artifact_triples` 表：存储知识图谱三元组。
    *   `pottery_artifacts` / `jade_artifacts` 表结构更新，增加结构化字段。

## 2. 升级步骤

由于数据库结构发生了重大变化，建议**重置数据库**。

### 2.1 备份数据（可选）
如果您有重要数据，请先备份 `database/artifacts_v3.db` 文件。

### 2.2 重置数据库
1.  启动 GUI：`streamlit run gui/app_v3.py`
2.  在侧边栏找到 **"💾 数据库"** 区域。
3.  点击 **"🔄 重置并初始化数据库 (V3.2)"** 按钮。
    *   系统会自动删除旧数据库文件。
    *   系统会应用新的 V3.2 Schema。

### 2.3 重新抽取
1.  进入 **"🚀 数据抽取"** 页面。
2.  选择报告和模版，点击 **"🚀 开始抽取"**。
3.  系统会自动：
    *   读取 Excel 模版并注册到 `sys_template_mappings`。
    *   抽取数据并写入实体表。
    *   生成语义三元组并写入 `fact_artifact_triples`。

## 3. 新功能使用

### 3.1 查看知识图谱定义
在 **"📊 数据浏览"** 页面，选择 **"📚 知识图谱定义"** 模式，可以看到当前所有字段与 CIDOC-CRM 的映射关系。

### 3.2 查看语义三元组
在 **"📊 数据浏览" -> "文物浏览"** 模式下，点击任意文物，展开 **"🔗 语义三元组 (Knowledge Graph)"** 折叠栏，即可看到该文物的实体关系数据。

### 3.3 查看原始数据
在同一位置，展开 **"📝 原始数据 (Raw JSON)"**，可以看到 LLM 返回的最原始数据，用于核对。

