# V3.1 架构升级：双层存储与知识图谱支持

针对您提出的关于“字段覆盖率”和“CIDOC-CRM 知识图谱化”的深刻反馈，我们对系统进行了 V3.1 版本的重大升级。

## 1. 核心设计理念：双层存储 (Dual-Layer Storage)

我们不再试图将所有灵活的 Excel 属性强行塞入固定的数据库列，而是采用了“既要...又要...”的策略：

| 层级 | 字段名 | 格式 | 用途 | 优势 |
| :--- | :--- | :--- | :--- | :--- |
| **结构化层** | `clay_type`, `height`... | SQL Columns | 快速查询、排序、统计 | 性能高，易于分析 |
| **原始层** | `raw_attributes` | JSON | 数据溯源、详情展示 | **100% 覆盖** Excel 属性，绝不遗漏 |
| **语义层** | `cidoc_attributes` | JSON | 知识图谱构建 | 直接存储 Entity/Property 映射关系 |

## 2. 解决您的问题

### 问题 1 & 2: 字段对应与覆盖 (N:1 / 不遗漏)
*   **解决方案**：现在，LLM 抽取到的**所有**原始键值对（如 `{ "陶土种类": "夹砂陶", "纹饰类型": "绳纹" }`）都会完整存储在 `raw_attributes` 字段中。
*   **效果**：无论 Excel 模板如何修改，数据库都能照单全收，保证数据**零丢失**。GUI 展示时，可以直接读取这个 JSON 来展示最原始的抽取结果。

### 问题 3: CIDOC-CRM 知识图谱化
*   **解决方案**：在数据抽取入库时，系统会读取 Excel 模板中的 CIDOC 定义（Entity, Property, Class），并生成结构化的语义数据存入 `cidoc_attributes`。
*   **数据样例**：
    ```json
    {
      "陶土种类": {
        "value": "夹砂红陶",
        "entity_type": "E22_Man-Made_Object",
        "property": "P45_consists_of",
        "target_class": "E57_Material"
      }
    }
    ```
*   **效果**：后续构建知识图谱时，无需再次解析 Excel，直接从数据库读取该字段即可生成节点和边。

## 3. 已执行的操作

1.  **更新设计文档**：`DATABASE_DESIGN_V3.md` 已更新。
2.  **更新数据库 Schema**：`schema_v3.sql` 已添加 `raw_attributes` 和 `cidoc_attributes` 字段。
3.  **重置数据库**：已自动为您重置了数据库，应用了新的 Schema。
4.  **更新代码**：`src/workflow.py` 已升级，支持生成和保存上述两类新数据。

---

**请重新运行抽取任务。**
这次，您将在数据库中获得最完整的数据，不仅包含用于查询的字段，还包含完整的原始数据和为知识图谱准备的语义数据。🚀

